#!/usr/bin/env sh

{
    . "$(dirname $0)/../../common"

    JDK_DMG="jdk-8u144-macosx-x64.dmg"
    JDK_DMG_URL="http://download.oracle.com/otn-pub/java/jdk/8u144-b01/090f390dda5b47b9b721c7dfaa008135/$JDK_DMG"
    JDK_VOL="/Volumes/JDK 8 Update 144"
    JDK_PKG="$JDK_VOL/JDK 8 Update 144.pkg"

    java_mac_check() {
        which java > /dev/null
        java -version 2>&1 | grep -q "^java version \"1.8.0"
    }

    java_mac_exec() {
        java_macpath=$(java_mac_path)
        $java_macpath $@
    }

    java_mac_deps() {
        echo "curl sudo pkgmgr.d/macdmg"
    }

    java_mac_install() {
        curl -j -L --progress-bar \
            -H "Cookie: oraclelicense=accept-securebackup-cookie" \
            -o $HOME/Downloads/$JDK_DMG \
            $JDK_DMG_URL || return 1

        macdmg="$(dirname $0)/../pkgmgr.d/macdmg"
        $macdmg install \
            -dmg "$HOME/Downloads/$JDK_DMG" \
            -pkg "$JDK_PKG" \
            -vol "$JDK_VOL" || return 1

        rm "$HOME/Downloads/$JDK_DMG"; return $?
    }

    java_mac_path() {
        java_mac_check && which java
    }

    command=$1
    shift
    case $command in
        check | deps | exec | install | path)
            java_mac_$command $@
            ;;
    esac
}
